## 6.1、业务流程异步化
除了调用一些库存检查、用户校验这样一些从数据库读取数据进行业务判断的服务外。
通过消息中间件实现
## 6.2、数据库事务异步化
把大事务分解成小事务，通过消息中间件实现
## 6.3、事务与柔性事务
### 6.3.1、CAP理论
CAP理论： 一个分布式系统最多只能同时满足一致性（Consistency) 、可用性（Availability)、
分区容错性（Partition tolerance)
- 一致性：所有节点在同一时间的数据完全一致
- 可用性：用户在访问数据时可以得到及时的响应
- 分区容错性： 指分布式系统在遇到某个节点或网络分区故障的时候，仍然能够对外提供满足一致性和可用性的服务。

### 6.3.2、BASE理论
BASE是指基本可用（Basically Available）、柔性状态（Soft State)、最终一致性（Eventual Consistency)
- 基本可用： 指分布式系统在出现故障的时候，允许损失部分可用性，即保证核心可用，服务降级
- 柔性状态： 指允许系统存在中间状态，而该中间状态不会影响系统的整体可用性、分布式存储中一般一份数据至少会有三个副本，允许
不同节点间副本同步的延时就是柔性状态的体现。MySQL Replication的异步复制就是一种柔性状态体验
- 最终一致性： 指系统中的所有数据副本经过一定时间后，最终能够达到一致的状态。

#### 6.3.2.1、ACID和BASE的区别于联系
ACID是传统数据库常用的设计理念，追求强一致性模型、BASE支持的是大型分布式系统，提出通过牺牲强一致性获取高可用性。

### 6.3.3、传统分布式事务
两阶段提交： 第一阶段（准备阶段）， 第二阶段（提交阶段）

两阶段提交协议有一个重要优化，称为“最末参与者优化”（Last Participant Optimization LPO),允许两阶段提交协议中有一个参与者不实现“准备”
操作（称为单阶段参与者）

- X/OPEN 组织基于两阶段协议的分布式事务处理系统提出了标准的系统参考模型
    - X/Open模型定义了两个标准接口：TX接口用于应用程序向事务管理器发起事务、提交事务和回滚事务
    - XA接口形成了事务管理器和资源管理器之间的通信桥梁、用于事务管理器将资源管理器（如数据库、消息队列等）加入事务、并控制两阶段提交。
### 6.3.4、柔性事务如何解决分布式事务问题
1. 引入日志和补偿机制 ： 柔性事务的原子性主要由日志保证。 事务日志记录事务的开始、结束状态，可能还包括事务参与者信息。参与者节点也需要根据重做或
回滚需求记录REDO/UNDO日志，并根据状态决定是重试异常步骤（正向补偿），还是回滚前步骤（反向补偿）
2.  可靠消息传递： 消息会出现-“成功”、失败、不知道成功还是失败 ， 以及如何实现幂等性
3. 实现无锁
    - 避免事务进入回滚
    - 辅助业务变化明细表 ： 预减库存
    - 乐观锁： 基于版本号修改， CAS

## 6.4、大促秒杀活动催生缓存技术的高度使用